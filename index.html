<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zoo Feeder - ‡∏õ‡πâ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --app-height: 100dvh;
            --primary-bg: #eefdf2;
            --game-bg: #86efac;
            --belt-color: #64748b;
            --ui-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--primary-bg);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            height: var(--app-height);
            overflow: hidden;
            touch-action: none;
            /* ‡∏•‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏á‡πÜ */
            background-image: radial-gradient(#cbd5e1 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            color: #334155;
        }

        #game-container {
            position: relative;
            height: 100%;
            max-height: 920px;
            width: 100%;
            max-width: 500px;
            background: linear-gradient(180deg, #a7f3d0 0%, #6ee7b7 100%); /* ‡πÑ‡∏•‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
            overflow: hidden;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15);
            border-radius: 24px;
        }

        /* Desktop border */
        @media (min-width: 640px) {
            #game-container {
                height: 95vh;
                border: 8px solid #fff;
            }
        }

        /* --- Game Elements --- */
        
        #belt-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .belt {
            position: absolute;
            top: -20px; /* ‡∏î‡∏∂‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô */
            height: calc(100% - 220px);
            background: var(--belt-color);
            border-left: 3px solid rgba(0,0,0,0.1);
            border-right: 3px solid rgba(0,0,0,0.1);
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), width 0.5s ease-in-out;
            border-radius: 0 0 16px 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .belt-marking {
            position: absolute;
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            animation: moveBelt 4s linear infinite;
        }

        @keyframes moveBelt {
            0% { top: -60px; }
            100% { top: 100%; }
        }

        /* Animal Zone */
        #animal-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 280px;
            z-index: 15;
            pointer-events: none;
        }

        .animal-slot {
            position: absolute;
            bottom: 20px;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 140px;
        }

        .animal-emoji {
            font-size: 9rem;
            line-height: 1;
            filter: drop-shadow(0 8px 12px rgba(0,0,0,0.15));
            transition: transform 0.2s;
            z-index: 20;
            cursor: pointer;
        }
        
        .animal-diet-bubble {
            background: white;
            color: #334155;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            font-family: 'Fredoka', sans-serif;
            margin-bottom: -15px;
            z-index: 25;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 2px solid #f1f5f9;
            transform: scale(0.95);
        }

        .animal-happy .animal-emoji { animation: bounce 0.6s infinite alternate; }
        .animal-angry .animal-emoji { animation: shake 0.5s; }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        .food-item {
            position: absolute;
            width: 90px;
            height: 90px;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4.5rem;
            z-index: 30;
            cursor: pointer;
            user-select: none;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1));
            touch-action: manipulation;
            pointer-events: auto; 
            transition: transform 0.1s, opacity 0.3s;
        }
        .food-item:active { transform: translateX(-50%) scale(0.9); }

        /* --- HUD --- */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 50;
        }
        .stat-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            color: #475569;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .pause-btn {
            background: white;
            color: #64748b;
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.4rem;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: all 0.2s;
            border: 1px solid #f1f5f9;
        }
        .pause-btn:active { transform: scale(0.9); }

        /* --- Overlays (Clean & Soft) --- */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #334155;
            z-index: 100;
            text-align: center;
            padding: 30px;
            overflow-y: auto;
        }

        /* --- Level Cards (Modern Clean) --- */
        .level-card {
            background: white;
            border-radius: 20px;
            padding: 16px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            margin-bottom: 12px;
            border: 2px solid transparent;
        }
        .level-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .level-card:active { transform: scale(0.98); }

        .level-card.easy { border-color: #86efac; }
        .level-card.medium { border-color: #fde047; }
        .level-card.hard { border-color: #fca5a5; }

        .level-icon-box {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
        }
        .level-card.easy .level-icon-box { background: #dcfce7; color: #166534; }
        .level-card.medium .level-icon-box { background: #fef9c3; color: #854d0e; }
        .level-card.hard .level-icon-box { background: #fee2e2; color: #991b1b; }

        .level-info { text-align: left; flex: 1; }
        .level-title { font-size: 1.2rem; font-weight: 700; color: #1e293b; margin-bottom: 2px; }
        .level-desc { font-size: 0.9rem; font-weight: 400; color: #64748b; }

        /* Buttons (Soft & Rounded) */
        .btn-game {
            background: #3b82f6;
            color: white;
            padding: 14px 0;
            width: 100%;
            border-radius: 18px;
            font-size: 1.2rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
            transition: all 0.2s;
            border: none;
        }
        .btn-game:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(59, 130, 246, 0.2); }
        
        .btn-yellow { background: #f59e0b; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3); }
        .btn-green { background: #10b981; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
        .btn-secondary { background: #e2e8f0; color: #475569; box-shadow: none; }
        .btn-secondary:hover { background: #cbd5e1; }

        /* Animations */
        .feedback-text {
            position: absolute;
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            font-size: clamp(1.8rem, 4vw, 2.5rem); 
            pointer-events: none;
            z-index: 60;
            animation: floatUp 0.8s forwards;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.8);
            white-space: nowrap;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.8); opacity: 0; }
            20% { transform: translateY(-30px) scale(1.1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }
        
        .levelup-text {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            font-size: 4rem;
            color: #f59e0b;
            pointer-events: none;
            z-index: 70;
            animation: popText 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-shadow: 3px 3px 0 #fff, 0 4px 15px rgba(245, 158, 11, 0.4);
            white-space: nowrap;
        }
        @keyframes popText {
            0% { transform: translateX(-50%) scale(0); opacity: 0; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 0; }
        }

        .switch-alert {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: #334155;
            padding: 24px 32px;
            border-radius: 24px;
            font-family: 'Kanit', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            z-index: 80;
            text-align: center;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 85%;
            border: 1px solid #f1f5f9;
        }
        @keyframes slideIn {
            from { transform: translate(-50%, -20%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* Leaderboard */
        .leaderboard-container {
            width: 100%;
            background: #f8fafc;
            border-radius: 24px;
            padding: 8px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .lb-tabs {
            display: flex;
            background: #e2e8f0;
            border-radius: 16px;
            padding: 4px;
            margin: 10px;
        }
        .lb-tab {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            color: #64748b;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        .lb-tab.active {
            background: white;
            color: #0f172a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .leaderboard-table {
            width: 100%;
            font-size: 1rem;
        }
        .leaderboard-table th {
            text-align: left;
            padding: 12px;
            color: #94a3b8;
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 600;
        }
        .leaderboard-table td { 
            padding: 12px; 
            border-bottom: 1px solid #f1f5f9; 
            color: #334155;
        }
        .leaderboard-table tr:last-child td { border-bottom: none; }
        .rank-1 { color: #f59e0b; font-weight: 800; }
        .rank-2 { color: #94a3b8; font-weight: 800; }
        .rank-3 { color: #b45309; font-weight: 800; }

        #name-input {
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            padding: 16px;
            border-radius: 16px;
            color: #334155;
            font-size: 1.4rem;
            text-align: center;
            margin-bottom: 15px;
            outline: none;
            width: 100%;
            font-weight: 600;
            transition: all 0.2s;
        }
        #name-input:focus { border-color: #3b82f6; background: white; }

        /* Version Display */
        .version-tag {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: rgba(51, 65, 85, 0.4);
            font-size: 0.8rem;
            font-family: monospace;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- HUD -->
        <div class="hud">
            <div class="stat-group">
                <div class="stat-box text-yellow-500">
                    <span class="text-xl">‚≠ê</span> <span id="score">0</span>
                </div>
                <div class="stat-box text-blue-500">
                    <span>‚ö°</span> Lv.<span id="level">1</span>
                </div>
            </div>
            
            <div class="stat-group items-end">
                <button class="pause-btn" onclick="togglePause()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                </button>
                <div class="stat-box text-red-500">
                    <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
                <div class="stat-box text-gray-500 text-sm">
                    ‚è±Ô∏è <span id="timer">00:00</span>
                </div>
            </div>
        </div>

        <!-- Belts -->
        <div id="belt-container"></div>

        <!-- Animals -->
        <div id="animal-container"></div>

        <div id="food-layer"></div>

        <!-- Start Overlay -->
        <div id="start-overlay" class="overlay">
            <div class="mb-4 animate-bounce transform hover:scale-110 transition-transform pt-4">
                <h1 class="text-7xl sm:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-xl" style="filter: drop-shadow(0 6px 0 #b45309);">
                    ZOO<br>FEEDER
                </h1>
            </div>
            
            <div class="w-full max-w-sm mb-4 px-4 flex flex-col gap-3 flex-1 overflow-y-auto justify-center no-scrollbar">
                <!-- Easy Card -->
                <div class="level-card easy" onclick="startGame('easy')">
                    <div class="level-icon-box text-2xl">üê¢</div>
                    <div class="level-info">
                        <div class="level-title">‡πÇ‡∏´‡∏°‡∏î‡∏á‡πà‡∏≤‡∏¢</div>
                        <div class="level-desc">1 ‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô ‚Ä¢ ‡∏ä‡∏¥‡∏ß‡πÜ</div>
                    </div>
                </div>

                <!-- Medium Card -->
                <div class="level-card medium" onclick="startGame('medium')">
                    <div class="level-icon-box text-2xl">üêÜ</div>
                    <div class="level-info">
                        <div class="level-title">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                        <div class="level-desc">2 ‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô ‚Ä¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏∂‡∏á</div>
                    </div>
                </div>

                <!-- Hard Card -->
                <div class="level-card hard" onclick="startGame('hard')">
                    <div class="level-icon-box text-2xl">ü¶Ö</div>
                    <div class="level-info">
                        <div class="level-title">‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏õ‡∏£</div>
                        <div class="level-desc">3 ‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô ‚Ä¢ ‡πÑ‡∏ß‡∏à‡∏±‡∏î!</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-2xl mb-4 max-w-sm w-full mx-4 text-left text-sm shadow-sm border border-slate-100">
                <div class="mb-2 text-slate-500 flex items-center gap-2">
                    <span class="bg-red-100 text-red-600 p-1 rounded">ü•ï</span> ‡πÅ‡∏ï‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏ó‡∏¥‡πâ‡∏á <span class="text-green-600 font-bold">(+10)</span>
                </div>
                <div class="mb-2 text-slate-500 flex items-center gap-2">
                    <span class="bg-green-100 text-green-600 p-1 rounded">ü•©</span> ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô <span class="text-green-600 font-bold">(+20)</span>
                </div>
                <div class="text-yellow-600 font-bold mt-2 pt-2 border-t border-slate-100">‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏∏‡∏Å 500 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!</div>
            </div>

            <div class="w-full max-w-sm px-4 pb-4">
                <button class="btn-game btn-secondary" onclick="showLeaderboard('easy')">
                    üèÜ ‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                </button>
            </div>

            <!-- Version Number Display -->
            <div class="version-tag">v<span id="version-display"></span></div>
        </div>

        <!-- Pause Overlay -->
        <div id="pause-overlay" class="overlay hidden">
            <h2 class="text-5xl font-black mb-8 text-slate-800" style="font-family: 'Fredoka', sans-serif;">‡∏û‡∏±‡∏Å‡∏¢‡∏Å!</h2>
            <div class="flex flex-col gap-4 w-full max-w-xs">
                <button class="btn-game btn-green text-xl py-4" onclick="togglePause()">
                    ‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢
                </button>
                <button class="btn-game btn-secondary text-lg" onclick="quitToMenu()">
                    üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>
        </div>

        <!-- Leaderboard Overlay -->
        <div id="leaderboard-overlay" class="overlay hidden">
            <h2 class="text-4xl font-black mb-4 text-slate-800 pt-4" style="font-family: 'Fredoka', sans-serif;">üèÜ ‡∏´‡∏≠‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏¢‡∏®</h2>
            
            <div class="leaderboard-container max-w-sm w-full mb-4 max-h-[60vh] flex flex-col">
                <!-- Tabs -->
                <div class="lb-tabs">
                    <div id="tab-easy" class="lb-tab" onclick="renderLeaderboard('easy')">‡∏á‡πà‡∏≤‡∏¢</div>
                    <div id="tab-medium" class="lb-tab" onclick="renderLeaderboard('medium')">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                    <div id="tab-hard" class="lb-tab" onclick="renderLeaderboard('hard')">‡πÇ‡∏õ‡∏£</div>
                </div>

                <!-- Table -->
                <div class="overflow-y-auto flex-1 no-scrollbar">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th width="15%">#</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th width="25%" class="text-right">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                <th width="20%" class="text-right">‡πÄ‡∏ß‡∏•‡∏≤</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-list"></tbody>
                    </table>
                </div>
            </div>

            <div class="flex flex-col w-full max-w-xs gap-3 mb-4">
                <button class="btn-game btn-yellow py-3 text-lg text-white" onclick="downloadAnalytics()">
                    üì• ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö
                </button>
                <button class="btn-game btn-secondary w-full" onclick="showStartScreen()">
                    ‡∏Å‡∏•‡∏±‡∏ö
                </button>
            </div>
        </div>

        <!-- Game Over Overlay -->
        <div id="gameover-overlay" class="overlay hidden">
            <div class="bg-white p-8 rounded-[30px] w-full max-w-xs shadow-2xl text-slate-800 border border-slate-100 animate-bounce-in">
                <h1 class="text-5xl font-black mb-2 text-red-500 text-center" style="font-family: 'Fredoka', sans-serif;">‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h1>
                
                <div class="text-center mb-6">
                    <div class="text-slate-400 text-sm font-bold uppercase tracking-widest mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
                    <div id="final-score" class="text-7xl font-black text-slate-800">0</div>
                </div>

                <div class="flex justify-between bg-slate-50 p-4 rounded-2xl mb-6 font-bold text-slate-500 text-sm">
                    <div>‚è±Ô∏è <span id="final-time">00:00</span></div>
                    <div>üéÆ <span id="final-mode">‡∏á‡πà‡∏≤‡∏¢</span></div>
                </div>
                
                <!-- High Score Input -->
                <div id="highscore-section" class="hidden mb-6">
                    <p class="text-green-500 text-lg mb-2 font-bold animate-pulse text-center">üéâ ‡∏ï‡∏¥‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î! üéâ</p>
                    <input type="text" id="player-name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" maxlength="10">
                    <button class="btn-game btn-green text-xl py-3 shadow-none mt-3" onclick="saveScore()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>

                <!-- Buttons -->
                <div id="gameover-buttons" class="flex flex-col gap-3">
                    <button class="btn-game btn-yellow text-xl text-white" onclick="startGame(currentDifficulty)">üîÑ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                    <button class="btn-game btn-secondary text-xl" onclick="showStartScreen()">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const beltContainer = document.getElementById('belt-container');
        const animalContainer = document.getElementById('animal-container');
        const foodLayer = document.getElementById('food-layer');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const livesEl = document.getElementById('lives');
        const timerEl = document.getElementById('timer');
        
        const startOverlay = document.getElementById('start-overlay');
        const leaderboardOverlay = document.getElementById('leaderboard-overlay');
        const gameoverOverlay = document.getElementById('gameover-overlay');
        const pauseOverlay = document.getElementById('pause-overlay');
        const finalScoreEl = document.getElementById('final-score');
        const finalTimeEl = document.getElementById('final-time');
        const finalModeEl = document.getElementById('final-mode');
        
        const highscoreSection = document.getElementById('highscore-section');
        const gameoverButtons = document.getElementById('gameover-buttons');
        const leaderboardList = document.getElementById('leaderboard-list');
        const playerNameInput = document.getElementById('player-name');
        const versionDisplay = document.getElementById('version-display');

        // Settings & Version
        const GAME_VERSION = "1.3.0"; 
        const POINTS_PER_LEVEL = 100;
        const POINTS_PER_ANIMAL_CHANGE = 500;
        const MAX_BELTS = 3;
        
        const DB_KEYS = {
            'easy': 'zoo_score_easy_v1',
            'medium': 'zoo_score_medium_v1',
            'hard': 'zoo_score_hard_v1'
        };

        // Set Version on Load
        versionDisplay.innerText = GAME_VERSION;

        let score = 0;
        let lives = 3;
        let level = 1;
        let beltCount = 1;
        let currentDifficulty = 'easy';
        
        let gameActive = false;
        let isPaused = false;
        let foodItems = [];
        let speed = 1.0;
        let spawnRate = 2000;
        let lastSpawnTime = 0;
        let gameLoopReq;
        
        let currentAnimals = [];
        let isSwitching = false;
        
        let startTime;
        let timerInterval;
        let pausedTime = 0;
        let lastPauseStart = 0;
        let elapsedTimeStr = "00:00";

        // Stats Tracking
        let sessionStats = {
            fedCorrect: 0,
            fedWrongType: 0,
            fedTrash: 0,
            discardedCorrect: 0, 
            discardedGood: 0
        };

        // Handle viewport height on mobile browsers
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();

        const ANIMALS = [
            { emoji: 'ü¶Å', type: 'carn', name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', icon: 'ü•©' },
            { emoji: 'üêØ', type: 'carn', name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', icon: 'üçó' },
            { emoji: 'üêä', type: 'carn', name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', icon: 'üêü' },
            { emoji: 'üêò', type: 'herb', name: '‡∏û‡∏∑‡∏ä', icon: 'üåø' },
            { emoji: 'ü¶í', type: 'herb', name: '‡∏û‡∏∑‡∏ä', icon: 'üçÉ' },
            { emoji: 'üêá', type: 'herb', name: '‡∏û‡∏∑‡∏ä', icon: 'ü•ï' },
            { emoji: 'ü¶ç', type: 'herb', name: '‡∏û‡∏∑‡∏ä', icon: 'üçå' }
        ];

        const FOOD_TYPES = {
            HERB: ['üåø', 'üçé', 'ü•ï', 'ü•¨', 'üåΩ', 'üçâ', 'üçå'],
            CARN: ['ü•©', 'üçó', 'ü•ì', 'üêü', 'üçñ', 'ü¶ê'],
            TRASH: ['üëü', 'üí£', 'ü•´', 'üß±', 'üß§', 'üì¶']
        };

        const BELT_POSITIONS = {
            1: [50],
            2: [30, 70],
            3: [20, 50, 80]
        };

        function showStartScreen() {
            leaderboardOverlay.classList.add('hidden');
            gameoverOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            startOverlay.classList.remove('hidden');
        }

        function showLeaderboard(mode = 'easy') {
            renderLeaderboard(mode);
            startOverlay.classList.add('hidden');
            gameoverOverlay.classList.add('hidden');
            leaderboardOverlay.classList.remove('hidden');
        }

        function togglePause() {
            if (!gameActive) return;
            isPaused = !isPaused;
            
            if (isPaused) {
                pauseOverlay.classList.remove('hidden');
                lastPauseStart = Date.now();
                cancelAnimationFrame(gameLoopReq);
            } else {
                pauseOverlay.classList.add('hidden');
                pausedTime += Date.now() - lastPauseStart;
                lastSpawnTime += (Date.now() - lastPauseStart); 
                gameLoopReq = requestAnimationFrame(gameLoop);
            }
        }

        function quitToMenu() {
            gameActive = false;
            isPaused = false;
            cancelAnimationFrame(gameLoopReq);
            clearInterval(timerInterval);
            pauseOverlay.classList.add('hidden');
            showStartScreen();
        }

        function renderLeaderboard(mode) {
            const tabs = ['easy', 'medium', 'hard'];
            tabs.forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if(t === mode) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
                el.onclick = () => renderLeaderboard(t);
            });

            const key = DB_KEYS[mode];
            const scores = JSON.parse(localStorage.getItem(key)) || [];
            
            leaderboardList.innerHTML = scores.map((s, index) => {
                let rankClass = index === 0 ? 'rank-1' : (index === 1 ? 'rank-2' : (index === 2 ? 'rank-3' : 'text-slate-400'));
                
                return `
                    <tr>
                        <td class="${rankClass} text-center font-bold">${index + 1}</td>
                        <td class="font-semibold text-slate-700 truncate max-w-[100px]">${s.name}</td>
                        <td class="${rankClass} text-right">${s.score}</td>
                        <td class="text-slate-400 text-sm text-right font-medium">${s.time || '00:00'}</td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="4" class="text-center text-slate-400 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏á</td></tr>';
        }

        function saveScore() {
            const name = playerNameInput.value.trim() || '‡∏ô‡∏¥‡∏£‡∏ô‡∏≤‡∏°';
            const newScore = {
                name: name,
                score: score,
                time: elapsedTimeStr,
                date: new Date().toISOString()
            };
            
            const key = DB_KEYS[currentDifficulty];
            let scores = JSON.parse(localStorage.getItem(key)) || [];
            scores.push(newScore);
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 10); 
            
            localStorage.setItem(key, JSON.stringify(scores));
            
            showLeaderboard(currentDifficulty);
        }

        function saveSessionAnalytics() {
            const sessionData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                mode: currentDifficulty,
                finalScore: score,
                finalLevel: level,
                durationSeconds: Math.floor((Date.now() - startTime - pausedTime) / 1000),
                stats: { ...sessionStats }
            };

            let history = JSON.parse(localStorage.getItem('zoo_game_analytics')) || [];
            history.push(sessionData);
            localStorage.setItem('zoo_game_analytics', JSON.stringify(history));
        }

        function downloadAnalytics() {
            const data = localStorage.getItem('zoo_game_analytics');
            if (!data) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á');
                return;
            }
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zoo_feeder_analytics_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function updateTimer() {
            if (!gameActive || isPaused) return;
            const now = Date.now();
            const diff = Math.floor((now - startTime - pausedTime) / 1000);
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;
            elapsedTimeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timerEl.innerText = elapsedTimeStr;
        }

        function startGame(difficulty) {
            score = 0;
            lives = 3;
            level = 1;
            currentDifficulty = difficulty;
            pausedTime = 0;
            isPaused = false;
            
            // Reset Stats
            sessionStats = {
                fedCorrect: 0,
                fedWrongType: 0,
                fedTrash: 0,
                discardedCorrect: 0,
                discardedGood: 0
            };
            
            if (difficulty === 'easy') {
                beltCount = 1; speed = 1.0; spawnRate = 2000;
            } else if (difficulty === 'medium') {
                beltCount = 2; speed = 0.9; spawnRate = 1400;
            } else if (difficulty === 'hard') {
                beltCount = 3; speed = 0.8; spawnRate = 900;
            }
            
            clearFood();
            startTime = Date.now();
            elapsedTimeStr = "00:00";
            timerEl.innerText = elapsedTimeStr;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);

            generateAnimals(beltCount);
            updateScene();
            updateUI();
            
            gameActive = true;
            startOverlay.classList.add('hidden');
            gameoverOverlay.classList.add('hidden');
            leaderboardOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            
            lastSpawnTime = performance.now();
            if (gameLoopReq) cancelAnimationFrame(gameLoopReq);
            gameLoopReq = requestAnimationFrame(gameLoop);
        }

        function clearFood() {
            foodItems.forEach(item => item.el.remove());
            foodItems = [];
        }

        function getRandomAnimal() {
            return ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
        }

        function generateAnimals(count) {
            currentAnimals = [];
            for (let i = 0; i < count; i++) {
                currentAnimals.push(getRandomAnimal());
            }
        }

        function updateScene(updateBelts = true) {
            if (updateBelts) {
                beltContainer.innerHTML = '';
                const positions = BELT_POSITIONS[beltCount];
                const beltWidth = beltCount === 3 ? '22%' : (beltCount === 2 ? '32%' : '45%');

                positions.forEach(pos => {
                    const belt = document.createElement('div');
                    belt.className = 'belt';
                    belt.style.left = `calc(${pos}% - (${beltWidth} / 2))`;
                    belt.style.width = beltWidth;
                    for(let i=10; i<100; i+=25) {
                        const mark = document.createElement('div');
                        mark.className = 'belt-marking';
                        mark.style.top = i + '%';
                        belt.appendChild(mark);
                    }
                    beltContainer.appendChild(belt);
                });
            }

            renderAnimalsOnly();
        }

        function renderAnimalsOnly() {
            animalContainer.innerHTML = '';
            const positions = BELT_POSITIONS[beltCount];
            currentAnimals.forEach((animal, index) => {
                const pos = positions[index];
                const slot = document.createElement('div');
                slot.className = 'animal-slot';
                slot.style.left = `${pos}%`;
                slot.id = `animal-slot-${index}`;

                const diet = document.createElement('div');
                diet.className = 'animal-diet-bubble';
                diet.innerHTML = `<span>${animal.icon}</span>`;
                slot.appendChild(diet);

                const emoji = document.createElement('div');
                emoji.className = 'animal-emoji';
                emoji.innerText = animal.emoji;
                slot.appendChild(emoji);

                animalContainer.appendChild(slot);
            });
        }

        function addScore(points) {
            const oldLevel = level;
            const oldAnimalStage = Math.floor(score / POINTS_PER_ANIMAL_CHANGE);
            
            score += points;
            
            const newLevel = Math.floor(score / POINTS_PER_LEVEL) + 1;
            const newAnimalStage = Math.floor(score / POINTS_PER_ANIMAL_CHANGE);

            // Level Up (Speed + Spawn Rate)
            if (newLevel > oldLevel) {
                level = newLevel;
                speed += 0.1;
                spawnRate = Math.max(400, spawnRate - 80);
                showLevelUpText();
            }

            // Animal Change Logic
            if (newAnimalStage > oldAnimalStage) {
                // !!! RESET BELT ITEMS HERE !!!
                clearFood(); 

                if (beltCount === 1) {
                    generateAnimals(beltCount);
                    const alert = document.createElement('div');
                    alert.className = 'switch-alert';
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á
                    alert.innerHTML = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå!<br><span class='text-lg font-normal text-slate-500'>‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô...</span>";
                    gameContainer.appendChild(alert);
                    setTimeout(() => alert.remove(), 1500);
                } else {
                    // Medium/Hard: Switch ONLY ONE random animal
                    const laneIndex = Math.floor(Math.random() * beltCount);
                    const oldAnimal = currentAnimals[laneIndex];
                    let newAnimal;
                    do {
                        newAnimal = ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
                    } while (newAnimal.emoji === oldAnimal.emoji);
                    
                    currentAnimals[laneIndex] = newAnimal;
                    
                    const alert = document.createElement('div');
                    alert.className = 'switch-alert';
                    alert.innerHTML = "‡∏£‡∏∞‡∏ß‡∏±‡∏á!<br><span class='text-lg font-normal text-slate-500'>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå & ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á</span>";
                    gameContainer.appendChild(alert);
                    setTimeout(() => alert.remove(), 1500);
                }
                renderAnimalsOnly();
            }
            
            updateUI();
        }

        function showLevelUpText() {
            const txt = document.createElement('div');
            txt.className = 'levelup-text';
            txt.innerText = `LEVEL UP!`;
            gameContainer.appendChild(txt);
            setTimeout(() => txt.remove(), 1500);
        }

        function spawnFood() {
            const lanes = BELT_POSITIONS[beltCount];
            const laneIndex = Math.floor(Math.random() * lanes.length);
            const targetAnimal = currentAnimals[laneIndex];
            
            const rand = Math.random();
            let type, pool;

            if (rand < 0.25) { type = 'trash'; pool = FOOD_TYPES.TRASH; }
            else if (rand < 0.6) { type = targetAnimal.type === 'herb' ? 'carn' : 'herb'; pool = targetAnimal.type === 'herb' ? FOOD_TYPES.CARN : FOOD_TYPES.HERB; }
            else { type = targetAnimal.type; pool = targetAnimal.type === 'herb' ? FOOD_TYPES.HERB : FOOD_TYPES.CARN; }

            const emoji = pool[Math.floor(Math.random() * pool.length)];
            const el = document.createElement('div');
            el.className = 'food-item';
            el.innerText = emoji;
            
            const lanePos = lanes[laneIndex];
            el.style.left = `${lanePos}%`;
            el.style.top = '-100px';
            
            const itemObj = {
                el: el,
                type: type,
                laneIndex: laneIndex,
                y: -100,
                sorted: false,
                id: Date.now() + Math.random()
            };

            el.onpointerdown = (e) => {
                e.stopPropagation();
                handleItemClick(itemObj);
            };

            foodLayer.appendChild(el);
            foodItems.push(itemObj);
        }

        function gameLoop(time) {
            if (!gameActive || isPaused) return; 
            
            if (!isSwitching && time - lastSpawnTime > spawnRate) {
                spawnFood();
                lastSpawnTime = time;
            }
            for (let i = foodItems.length - 1; i >= 0; i--) {
                const item = foodItems[i];
                if (!item.sorted) {
                    item.y += speed;
                    item.el.style.top = item.y + 'px';
                    // Check reach bottom (height of game - animal height)
                    // Animal zone is 30vh or min 280px
                    const animalZoneH = 280;
                    if (item.y > gameContainer.offsetHeight - animalZoneH) handleReachAnimal(i);
                }
            }
            gameLoopReq = requestAnimationFrame(gameLoop);
        }

        function handleReachAnimal(index) {
            const item = foodItems[index];
            item.sorted = true;
            
            const currentAnimalInLane = currentAnimals[item.laneIndex];
            const isCorrectFood = (item.type === currentAnimalInLane.type);

            item.el.style.transition = 'all 0.3s ease-in';
            item.el.style.transform = `translate(-50%, 50px) scale(0.5)`; // Fall into animal
            item.el.style.opacity = '0';

            const animalSlot = document.getElementById(`animal-slot-${item.laneIndex}`);

            if (isCorrectFood) {
                if (animalSlot) {
                    animalSlot.classList.add('animal-happy');
                    setTimeout(() => animalSlot.classList.remove('animal-happy'), 500);
                }
                showFeedback('+20', item.laneIndex, '#10b981');
                addScore(20); 
                sessionStats.fedCorrect++;
            } else {
                lives--;
                const msg = item.type === 'trash' ? '‡∏Å‡∏¥‡∏ô‡∏Ç‡∏¢‡∏∞!' : '‡∏ú‡∏¥‡∏î!';
                if(item.type === 'trash') sessionStats.fedTrash++;
                else sessionStats.fedWrongType++;
                
                showFeedback(`${msg} -‚ù§Ô∏è`, item.laneIndex, '#ef4444');
                if (animalSlot) {
                    animalSlot.classList.add('animal-angry');
                    setTimeout(() => animalSlot.classList.remove('animal-angry'), 500);
                }
                updateUI();
            }

            setTimeout(() => {
                if(item.el && item.el.parentNode) item.el.remove();
                foodItems = foodItems.filter(f => f !== item);
            }, 300);

            if (lives <= 0) gameOver();
        }

        function handleItemClick(item) {
            if (!gameActive || isSwitching || item.sorted || isPaused) return; 
            item.sorted = true;

            const currentAnimalInLane = currentAnimals[item.laneIndex];
            const isCorrectFood = (item.type === currentAnimalInLane.type);

            const direction = Math.random() > 0.5 ? 'right' : 'left';
            const targetX = direction === 'left' ? -300 : 300;

            item.el.style.transition = 'all 0.4s ease-out';
            item.el.style.transform = `translate(calc(-50% + ${targetX}px), 0) rotate(${direction==='left'?'-45deg':'45deg'})`;
            item.el.style.opacity = '0';

            if (!isCorrectFood) {
                showFeedback('+10', item.laneIndex, '#fff');
                addScore(10);
                sessionStats.discardedCorrect++;
            } else {
                lives--;
                showFeedback('‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏≥‡πÑ‡∏°! -‚ù§Ô∏è', item.laneIndex, '#f59e0b');
                sessionStats.discardedGood++;
                updateUI();
            }

            setTimeout(() => {
                if(item.el && item.el.parentNode) item.el.remove();
                foodItems = foodItems.filter(f => f !== item);
            }, 400);

            if (lives <= 0) gameOver();
        }

        function showFeedback(text, laneIndex, color) {
            const fb = document.createElement('div');
            fb.className = 'feedback-text';
            fb.innerText = text;
            fb.style.color = color;
            
            const positions = BELT_POSITIONS[beltCount];
            if (positions && positions[laneIndex]) fb.style.left = `${positions[laneIndex]}%`;
            else fb.style.left = '50%';
            
            fb.style.top = '60%';
            fb.style.transform = 'translateX(-50%)';
            gameContainer.appendChild(fb);
            setTimeout(() => fb.remove(), 1000);
        }

        function updateUI() {
            scoreEl.innerText = score;
            levelEl.innerText = level;
            livesEl.innerText = '‚ù§Ô∏è'.repeat(Math.max(0, lives));
        }

        function gameOver() {
            gameActive = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(gameLoopReq);
            
            // Save detailed analytics silently
            saveSessionAnalytics();
            
            finalScoreEl.innerText = score;
            finalTimeEl.innerText = elapsedTimeStr;
            
            let modeLabel = '‡∏á‡πà‡∏≤‡∏¢';
            if(currentDifficulty === 'medium') modeLabel = '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
            if(currentDifficulty === 'hard') modeLabel = '‡πÇ‡∏õ‡∏£';
            finalModeEl.innerText = modeLabel;
            
            gameoverOverlay.classList.remove('hidden');

            const key = DB_KEYS[currentDifficulty];
            const scores = JSON.parse(localStorage.getItem(key)) || [];
            const minScore = scores.length < 10 ? 0 : scores[scores.length - 1].score;

            if (score > minScore || scores.length < 10) {
                highscoreSection.classList.remove('hidden');
                gameoverButtons.classList.add('hidden');
                playerNameInput.value = '';
                playerNameInput.focus();
            } else {
                highscoreSection.classList.add('hidden');
                gameoverButtons.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>